#!/bin/sh

force_version=yes
if test "$1" == '--skip-check'; then
  force_version=no
fi

# required version of autotools
am_require=1.9.6
ac_require=2.59
lt_require=1.5.22
if `(glibtoolize --version) > /dev/null 2>&1`; then
  LIBTOOLIZE=glibtoolize
else
  LIBTOOLIZE=libtoolize
fi

if test -f configure.ac; then :; else
  echo "Error: configure.ac not found." 1>&2
  exit -1
fi

if test "x$force_version" = xyes; then
  am_version=`automake --version 2>&1 | head -1 | cut -d ' ' -f 4`
  ac_version=`autoconf --version 2>&1 | head -1 | cut -d ' ' -f 4`
  lt_version=`$LIBTOOLIZE --version 2>&1 | head -1 | cut -d ' ' -f 4`

  have_autotools=yes
  if test "x$am_version" != "x$am_require"; then
    echo "Error: automake version $am_require is required, but found $am_version." 1>&2
    have_autotools=no
  fi
  if test "x$ac_version" != "x$ac_require"; then
    echo "Error: autoconf version $ac_require is required, but found $ac_version." 1>&2
    have_autotools=no
  fi
  if test "x$lt_version" != "x$lt_require"; then
    echo "Error: libtool version $lt_require is required, but found $lt_version." 1>&2
    have_autotools=no
  fi
  if test "$have_autotools" = no; then
    exit -1
  fi
fi

if test -d config; then
  aclocal_flags='-I config'
fi

echo aclocal $aclocal_flags
     aclocal $aclocal_flags
[ "$?" -ne 0 ] && exit $?

echo $LIBTOOLIZE --force --copy
     $LIBTOOLIZE --force --copy
[ "$?" -ne 0 ] && exit $?

CONFIG_H=`find . -name config.h.in`
for c in $CONFIG_H; do
  echo touch $c
       touch $c
done

echo automake --foreign --add-missing --copy
     automake --foreign --add-missing --copy
[ "$?" -ne 0 ] && exit $?

echo autoconf
     autoconf
[ "$?" -ne 0 ] && exit $?

rm -rf autom4te.cache
