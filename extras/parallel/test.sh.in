#!/bin/sh

SOURCE_DIR=@CMAKE_CURRENT_SOURCE_DIR@

set -x
make -j parallel

if test $? == 0; then
  mpirun -np 2 parallel --mpi < $SOURCE_DIR/parallel.ip | diff $SOURCE_DIR/parallel.op-2 -
  mpirun -np 3 parallel --mpi < $SOURCE_DIR/parallel.ip | diff $SOURCE_DIR/parallel.op-3 -
  mpirun -np 4 parallel --mpi < $SOURCE_DIR/parallel.ip | diff $SOURCE_DIR/parallel.op-4 -
fi
